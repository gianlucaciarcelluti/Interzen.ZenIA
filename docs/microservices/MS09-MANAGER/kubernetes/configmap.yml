apiVersion: v1
kind: ConfigMap
metadata:
  name: ms09-config
  namespace: zenia
  labels:
    app: ms09-manager
    component: workflow-engine
data:
  # Database Configuration
  database.host: "ms09-postgresql.zenia.svc.cluster.local"
  database.port: "5432"
  database.name: "zenia_workflow_manager"
  database.schema: "public"

  # Redis Configuration
  redis.host: "ms09-redis.zenia.svc.cluster.local"
  redis.port: "6379"
  redis.database: "0"
  redis.timeout: "2000ms"
  redis.pool.max-active: "20"
  redis.pool.max-idle: "10"
  redis.pool.min-idle: "5"

  # RabbitMQ Configuration
  rabbitmq.host: "ms09-rabbitmq.zenia.svc.cluster.local"
  rabbitmq.port: "5672"
  rabbitmq.virtual-host: "/zenia"

  # Elasticsearch Configuration
  elasticsearch.host: "ms09-elasticsearch.zenia.svc.cluster.local"
  elasticsearch.port: "9200"
  elasticsearch.index.workflow-events: "zenia-workflow-events"
  elasticsearch.index.workflow-metrics: "zenia-workflow-metrics"

  # Workflow Engine Configuration
  workflow.engine.threads.core: "10"
  workflow.engine.threads.max: "50"
  workflow.engine.queue.capacity: "1000"
  workflow.engine.step.timeout.default: "300s"
  workflow.engine.retry.max-attempts: "3"
  workflow.engine.retry.backoff.multiplier: "2.0"
  workflow.engine.retry.backoff.initial: "1s"
  workflow.engine.retry.backoff.max: "300s"

  # State Manager Configuration
  workflow.state.snapshot.interval: "100"
  workflow.state.snapshot.retention.days: "90"
  workflow.state.persistence.batch-size: "50"
  workflow.state.cache.ttl: "3600s"

  # Transaction Manager Configuration
  workflow.transaction.saga.timeout: "1800s"
  workflow.transaction.compensation.timeout: "300s"
  workflow.transaction.retry.max-attempts: "5"

  # Monitoring Configuration
  management.metrics.export.prometheus.enabled: "true"
  management.metrics.export.jmx.enabled: "false"
  management.endpoint.health.show-details: "when-authorized"
  management.endpoint.metrics.enabled: "true"
  management.endpoint.prometheus.enabled: "true"

  # Logging Configuration
  logging.level.com.zenia.workflow: "INFO"
  logging.level.org.springframework.security: "DEBUG"
  logging.level.org.springframework.transaction: "DEBUG"
  logging.pattern.console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  logging.pattern.file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

  # Security Configuration
  spring.security.oauth2.resourceserver.jwt.issuer-uri: "https://auth.zenia.local"
  spring.security.oauth2.resourceserver.jwt.jwk-set-uri: "https://auth.zenia.local/.well-known/jwks.json"

  # Circuit Breaker Configuration
  resilience4j.circuitbreaker.instances.ms04-validator.failure-rate-threshold: "50"
  resilience4j.circuitbreaker.instances.ms04-validator.slow-call-rate-threshold: "50"
  resilience4j.circuitbreaker.instances.ms04-validator.slow-call-duration-threshold: "30s"
  resilience4j.circuitbreaker.instances.ms04-validator.permitted-number-of-calls-in-half-open-state: "3"
  resilience4j.circuitbreaker.instances.ms04-validator.sliding-window-size: "10"
  resilience4j.circuitbreaker.instances.ms04-validator.minimum-number-of-calls: "5"
  resilience4j.circuitbreaker.instances.ms04-validator.wait-duration-in-open-state: "60s"

  # Rate Limiting Configuration
  resilience4j.ratelimiter.instances.workflow-creation.limit-for-period: "100"
  resilience4j.ratelimiter.instances.workflow-creation.limit-refresh-period: "60s"
  resilience4j.ratelimiter.instances.workflow-creation.timeout-duration: "5s"

  # Application Configuration
  zenia.workflow.validation.enabled: "true"
  zenia.workflow.audit.enabled: "true"
  zenia.workflow.metrics.enabled: "true"
  zenia.workflow.notifications.enabled: "true"
  zenia.workflow.webhooks.enabled: "true"
  zenia.workflow.scheduling.enabled: "true"

  # Feature Flags
  zenia.workflow.features.parallel-processing: "true"
  zenia.workflow.features.human-tasks: "true"
  zenia.workflow.features.dynamic-variables: "true"
  zenia.workflow.features.compensation: "true"
  zenia.workflow.features.event-sourcing: "true"
  zenia.workflow.features.snapshotting: "true"